<section class="annuncio-dettaglio-container">

  <h2 class="titolo-annuncio">{{ annuncio?.titolo }}</h2>

  <section class="riga-annuncio">

      <div class="left-col">
          <div *ngIf="(annuncio?.foto?.length ?? 0) > 0; else noFoto" id="carouselAnnuncio" class="carousel slide fixed-carousel" data-bs-ride="carousel">
              <div class="carousel-inner h-100">
                  <div *ngFor="let f of (annuncio?.foto ?? []); let i = index"
                       class="carousel-item h-100"
                       [class.active]="i === 0">
                      <img [src]="'data:image/jpeg;base64,' + f.dati"
                           class="d-block w-100 carousel-image"
                           [alt]="'Foto ' + (i + 1)">
                  </div>
              </div>

              <button class="carousel-control-prev" type="button" data-bs-target="#carouselAnnuncio" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselAnnuncio" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
              </button>
          </div>

          <ng-template #noFoto>
              <div class="no-foto fixed-carousel d-flex align-items-center justify-content-center">
                  <p class="mb-0">Nessuna immagine disponibile</p>
              </div>
          </ng-template>
      </div>

      <aside class="right-col">
          <section class="info-venditore">
              <p><i class="bi bi-person"></i> <strong>Utente:</strong> {{ venditore?.nome }}</p>
              <p><i class="bi bi-telephone"></i> <strong>Cellulare:</strong> {{ venditore?.cellulare }}</p>
              <p><i class="bi bi-envelope"></i> <strong>Email:</strong> {{ venditore?.email }}</p>

              <div class="bottoni-venditore mt-3">
                  <a class="btn btn-primary me-2" (click)="scrollTo('contact')"><i class="bi bi-chat-dots"></i> Contatta</a>
                  <a class="btn btn-outline-secondary" (click)="scrollTo('review')"><i class="bi bi-pencil-square"></i> Scrivi una recensione</a>
              </div>
          </section>
      </aside>
  </section>

  <app-asta-box *ngIf="annuncio" [annuncioId]="annuncio.id"></app-asta-box>

  <section class="dettagli-annuncio">
    <p><strong>Descrizione:</strong> {{ annuncio?.descrizione }}</p>
    <p><strong>Prezzo:</strong> {{ annuncio?.prezzo }} €</p>
    <p><strong>Categoria:</strong> {{ categoriaMap[annuncio?.categoria_id || 0] }}</p>
    <p><strong>Superficie:</strong> {{ annuncio?.superficie }} mq</p>
    <p><strong>Indirizzo:</strong> {{ annuncio?.indirizzo }}</p>
  </section>

  <div id="map" style="height: 300px; width: 100%;"></div>


  <app-contact-seller id="contact" *ngIf="annuncio"
    [venditoreId]="annuncio.venditore_id"
    [annuncioId]="annuncio.id"
    [annuncioTitolo]="annuncio.titolo">
  </app-contact-seller>


  <h3>Recensioni dell'annuncio:</h3>
  <p *ngIf="recensioni.length === 0">Ancora nessuna recensione.</p>

  <section class="recensioni" *ngIf="recensioni.length > 0">
      <div *ngFor="let r of recensioni" class="recensione">
          <p>Nome: {{ r.nome_autore }}</p>
          <p>Commento: {{ r.testo }}</p>
          <small>Voto: {{ r.voto }}/5 </small>
          <hr>
      </div>
  </section>

  <h4>Hai già visitato quest'immobile?</h4>
  <app-review-form id="review" [annuncio_id]="annuncio?.id"></app-review-form>
</section>
